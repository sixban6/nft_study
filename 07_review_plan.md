# 学习复习与记忆巩固计划 (对抗遗忘曲线)

学习 `nftables` 最怕的不是当时听不懂，而是学完几个月后，面对需要配防火墙的服务器，大脑一片空白。

本计划基于**艾宾浩斯遗忘曲线 (Ebbinghaus Forgetting Curve)** 设计，旨在帮你将上面 6 个阶段学到的内容，从“短期记忆”固化为“长期的肌肉记忆”。

---

## 核心复习原则

1. **不背命令，背逻辑**：不要死记 `add rule inet filter...`，只需要记住“向表里的链里加规则”这个逻辑。
2. **多敲多错，多错多记**：每次复习时，**务必在虚拟机动手敲一遍**，不要只用眼睛看。敲错一次排障的记忆，比看书十遍都深刻。
3. **结合实际业务**：遇到问题不要去 Google “如何用 iptables 解决”，强制自己想“如何用 nftables 解决”。

---

## 📅 艾宾浩斯记忆周期表

请在日历上打卡以下复习节点。

### 阶段一：初学期 (短期记忆对抗)

*   [ ] **学习当天 (Day 0)：**
    *   **任务：** 学习 [Stage 1](01_stage1_basic.md) 到 [Stage 3](03_stage3_advanced_structures.md)。
    *   **实战：** 写出包含 Table、Chain 和基础 Rule 的脚本，成功用集合 (Set) 屏蔽任意 3 个 IP。
*   [ ] **次日复习 (Day 1)：**
    *   **任务：** 学习 [Stage 4](04_stage4_state_machine.md) 到 [Stage 6](06_stage6_best_practices.md)。回顾前三天内容。
    *   **实战：** 默写出一张包含 `established,related accept` 状态机的 Web 服务器防御脚本。
*   [ ] **第三天 (Day 3)：**
    *   **任务：** 不看任何文档，给你的虚拟机配一套只开 SSH，其他全关，但允许对外访问的规则。
    *   **心法：** 忘掉语法没关系，只要你能想起用 `vmap` 分发端口，用 `ct state` 管状态，去查语法手册补全即可。

### 阶段二：巩固期 (中长期记忆转化)

*   [ ] **第七天 (Day 7)：**
    *   **任务：** 做一次完整的回顾。重点复习“集合(Sets)”、“字典(Vmap)” 和 “NAT 原理” 这三个最容易混淆的高级特性。
    *   **测验：** 完成本书附带的 [期末测试演练卷](08_final_exam.md)。如果你能及格，说明知识骨架已经形成。
*   [ ] **第十五天 (Day 15)：**
    *   **实战挑战：** 找一台带有 Docker 的机器，尝试用 `nftables` 分析 Docker 生成的 NAT 规则。
    *   **调试：** 故意写错一条端口配置，使用 `meta nftrace set 1` 找到这个包在哪里被丢弃的。
*   [ ] **第二十天 (Day 20)（进阶拓展）：**
    *   **任务：** 不看文档，纯手工通过 Docker Compose 搭建一次 **TPROXY 透明代理** 或 **双线多拨 (双 WAN 路由)** 拓扑。
    *   **检验：** 看到 `curl` 的包被成功劫持到本地 Python 端口，或是 Ping 通了非默认网关的 IP。

### 阶段三：长效期 (肌肉记忆形成)

*   [ ] **第三十天 (Day 30)：**
    *   **任务：** 闭卷。打开一个空白文件，能在 5 分钟内敲出一个带状态机的可用基础防火墙模板。并在 OpenWrt 环境下成功写出一段 `fw4` 的 `forward` 隔离挂载钩子。
*   [ ] **三个月后 (Day 90)：**
    *   **任务：** 在公司或个人项目中，找机会把一台机器的老旧 `iptables` 规则，手写替换为等效且更优雅的 `nftables` 规则。当你完成这一次重构，彻底算是毕业了。

---

## 🧠 记忆提示卡片 (Cheat Sheet)

把这几句话背下来（或者贴在工位上）：

1. **结构词汇**：`Table` (大表/命名空间) -> `Chain` (链/函数) -> `Rule` (规则/语句)。
2. **状态四兄弟**：`new` (初见), `established` (熟人), `related` (关系户), `invalid` (流氓)。保护自己就一条：`ct state established,related accept`。
3. **动作控制**：`accept` (下车), `drop` (掉崖), `reject` (被踹), `jump/goto` (转机)。
4. **NAT 两大护法**：改源头 (SNAT) 去 `postrouting`；改目的地 (DNAT/端口映射) 去 `prerouting`。
5. **高性能核弹**：多个 IP 用集合 `{}`。多数值分支用字典 `vmap`。
6. **防断网神技**：配置顶端永远加一句 `flush ruleset`。使用 `nft -f` 原子提交。
7. **高级黑魔法 (iproute2 联动)**：`ip rule` 是判断去翻哪张路由表的 `switch` 开关；`fwmark` 是跨越 nftables 和 iproute2 的全局变量标志印章。
