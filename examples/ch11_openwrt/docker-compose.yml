services:
  router:
    image: alpine:latest
    container_name: openwrt_sim_router
    cap_add:
      - NET_ADMIN
    sysctls:
      - net.ipv4.ip_forward=1
    command: >
      sh -c " apk add --no-cache nftables && tail -f /dev/null "
    networks:
      lan:
        ipv4_address: 192.168.1.254
      nas_net:
        ipv4_address: 192.168.2.254

  tv:
    image: alpine:latest
    container_name: openwrt_sim_tv
    mac_address: 00:11:22:33:44:55
    cap_add:
      - NET_ADMIN
    command: >
      sh -c " apk add --no-cache iproute2 iputils curl && ip route del default || true && ip route add default via 192.168.1.254 && tail -f /dev/null "
    networks:
      lan:
        ipv4_address: 192.168.1.11
    depends_on:
      - router

  guest:
    image: alpine:latest
    container_name: openwrt_sim_guest
    cap_add:
      - NET_ADMIN
    command: >
      sh -c " apk add --no-cache iproute2 iputils curl && ip route del default || true && ip route add default via 192.168.1.254 && tail -f /dev/null "
    networks:
      lan:
        ipv4_address: 192.168.1.200
    depends_on:
      - router

  nas:
    image: alpine:latest
    container_name: openwrt_sim_nas
    cap_add:
      - NET_ADMIN
    command: >
      sh -c " apk add --no-cache iproute2 iputils curl && ip route del default || true && ip route add default via 192.168.2.254 && tail -f /dev/null "
    networks:
      nas_net:
        ipv4_address: 192.168.2.10
    depends_on:
      - router

networks:
  lan:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.1.0/24
  nas_net:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.2.0/24
